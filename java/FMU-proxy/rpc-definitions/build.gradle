
plugins {
    id "org.jruyi.thrift" version "0.4.0"
    id "com.google.protobuf" version "0.8.6"
}

apply from: rootProject.file('publisher.gradle')

def definitions = "../../../rpc-definitions"

dependencies {

    compile group: 'org.apache.thrift', name: 'libthrift', version: '0.11.0'

    compile group: 'io.grpc', name: 'grpc-stub', version: grpc_version
    compile group: 'io.grpc', name: 'grpc-protobuf', version: grpc_version

}

compileThrift {
    createGenFolder false
    generator 'java', 'private-members'
    sourceItems "${definitions}/thrift"
}

protobuf {
    generatedFilesBaseDir = "$projectDir/build"
    protoc {
        artifact = 'com.google.protobuf:protoc:3.6.1'
    }
    plugins {
        grpc {
            artifact = "io.grpc:protoc-gen-grpc-java:${grpc_version}"
        }
    }
    generateProtoTasks {
        ofSourceSet('main')*.plugins {
            grpc {
                outputSubDir = 'java'
            }
        }
    }

}

sourceSets {
    main {
        proto {
            srcDir "${definitions}/proto"
        }
    }
}

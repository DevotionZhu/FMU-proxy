
plugins {
    id "org.jruyi.thrift" version "0.4.0"
    id "com.google.protobuf" version "0.8.6"
}

apply from: rootProject.file('publisher.gradle')

dependencies {

    implementation group: 'io.grpc', name: 'grpc-stub', version: grpc_version
    implementation group: 'io.grpc', name: 'grpc-protobuf', version: grpc_version

    implementation group: 'org.apache.thrift', name: 'libthrift', version: '0.11.0'
}

def definitions = "../../../rpc-definitions"

try  {
    
    'thrift'.execute()

    compileThrift {
        createGenFolder false
        generator 'java', 'private-members'
        sourceItems "${definitions}/thrift"
    }

} catch (Exception ex) {
    println ex
}

protobuf {
    generatedFilesBaseDir = "$projectDir/build"
    protoc {
        artifact = 'com.google.protobuf:protoc:3.6.1'
    }
    plugins {
        grpc {
            artifact = "io.grpc:protoc-gen-grpc-java:${grpc_version}"
        }
    }
    generateProtoTasks {
        ofSourceSet('main')*.plugins {
            grpc {
                outputSubDir = 'java'
            }
        }
    }

}

sourceSets {
    main {
        proto {
            srcDir "${definitions}/proto"
        }
    }
}

<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <title>JSON-RPC Javascript test</title>

    <script src="service.js"></script>

</head>
<body>

<script>


    (function () {

        var vr = 47
        var stop = 0.1
        var stepSize = 1e-2

        var service = new Service("localhost", 9092)
        service.onOpen(async function () {

            var fmuId = await service.load("http://folk.ntnu.no/laht/files/ControlledTemperature.fmu")
            console.log(await service.getModelDescription(fmuId))

            var slaveId = await service.createInstanceFromCS(fmuId)
            var status = await service.simpleSetup(slaveId)

            var t = 0;
            var t0 = performance.now()
            while ( t <= stop ) {

                var read = await service.readReal(slaveId, [vr])
                // console.log("t=" + t + ", " + read.value)

                var step = await service.doStep(slaveId, stepSize)
                if (step.status !== "OK") {
                    console.error("Step failed!")
                    break
                }
                t = step.simulationTime

            }

            var t1 = performance.now()
            console.log("elapsed=" + (t1 - t0) + "ms")

            var status = await service.terminate(slaveId)

            service.close()

        })


    })();

</script>

</body>
</html>